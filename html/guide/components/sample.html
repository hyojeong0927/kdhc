<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treeview and Datepicker</title>
    <!-- css -->
    <link rel="stylesheet" href="../../../assets/css/index.css">
    <!-- Load jQuery -->
    <script src="../../../assets/js/vendors/jquery-3.7.1.min.js"></script>
    <script src="../../../assets/js/vendors/bootstrap-treeview.min.js"></script>
    <script src="../../../assets/js/vendors/bootstrap-datepicker.min.js"></script>
    <script type="module" src="../../../assets/js/common.js"></script>
</head>
<body>

<div class="container mt-5">
    <h2>Treeview Example</h2>
    <div id="tree"></div>
    <button id="addNodeBtn" class="btn btn-primary">Add Node</button>
    <button id="removeNodeBtn" class="btn btn-danger">Remove Node</button>

    <hr>

    <h2>Datepicker Example</h2>
    <input type="text" id="startDate" class="datepicker" placeholder="Start Date">
    <input type="text" id="endDate" class="datepicker" placeholder="End Date">
</div>

<script>
$(document).ready(function() {
    // Initialize general datepicker
    $('.datepicker').datepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        todayHighlight: true
    });

    // Initialize startDate datepicker
    var startDate = $('#startDate').datepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        todayHighlight: true
    }).on('changeDate', function(e) {
        var startDateVal = e.date;
        // Set the start date for endDate picker
        $('#endDate').datepicker('setStartDate', startDateVal);
    });

    // Initialize endDate datepicker
    var endDate = $('#endDate').datepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        todayHighlight: true
    }).on('changeDate', function(e) {
        var endDateVal = e.date;
        // Set the end date for startDate picker
        $('#startDate').datepicker('setEndDate', endDateVal);
    });
});

// Treeview Data
var selectedNode = null;
var treeData = [
    {
        text: "부모 노드 1",
        nodes: [
            { text: "자식 노드 1-1" },
            { text: "자식 노드 1-2" }
        ]
    },
    {
        text: "부모 노드 2",
        nodes: [
            { text: "자식 노드 2-1" },
            { text: "자식 노드 2-2" }
        ]
    }
];

function initTree() {
    var tree = $('#tree').treeview({
        data: treeData,
        showBorder: false,
        expandIcon: 'glyphicon glyphicon-plus',
        collapseIcon: 'glyphicon glyphicon-minus',
        nodeIcon: 'glyphicon glyphicon-folder-close',
        onNodeSelected: function(event, data) {
            selectedNode = data;
            console.log("선택한 노드:", data.text);
        }
    });

    // If there's a selected node, ensure it's selected in the tree
    if (selectedNode) {
        var nodeId = selectedNode.nodeId;
        tree.treeview('selectNode', [nodeId, { silent: true }]);
    }
}

$(document).ready(function() {
    initTree();

    $('#addNodeBtn').click(function() {
        if (!selectedNode) {
            alert("추가할 부모 노드를 선택하세요!");
            return;
        }

        var newNode = { text: "새로운 노드" };

        if (!selectedNode.nodes) {
            selectedNode.nodes = [];
        }

        selectedNode.nodes.push(newNode);

        // Clear the tree and reinitialize it with updated data
        $('#tree').treeview('remove');
        initTree();
    });

    $('#removeNodeBtn').click(function() {
        if (!selectedNode) {
            alert("삭제할 노드를 선택하세요!");
            return;
        }

        function removeNodeRecursive(nodes, target) {
            return nodes
                .map(node => {
                    if (node.nodes) {
                        node.nodes = removeNodeRecursive(node.nodes, target);
                    }
                    return node === target ? null : node;
                })
                .filter(node => node !== null);
        }

        // Remove the node from the treeData
        treeData = removeNodeRecursive(treeData, selectedNode);
        selectedNode = null;

        // Clear the tree and reinitialize it with updated data
        $('#tree').treeview('remove');
        initTree();
    });
});

</script>

</body>
</html>
